# üöÄ Linguagens Suportadas pelo Kong para Plugins

Este documento apresenta uma vis√£o completa das linguagens de programa√ß√£o suportadas pelo Kong Gateway para desenvolvimento de plugins personalizados.

## üìã √çndice

- [Vis√£o Geral](#-vis√£o-geral)
- [Lua (Nativo)](#-lua-nativo---recomendado)
- [Python (PDK)](#-python-plugin-development-kit---pdk)
- [JavaScript/Node.js (PDK)](#-javascriptnodejs-plugin-development-kit---pdk)
- [Go (Experimental)](#-go-suporte-experimental)
- [Compara√ß√£o de Performance](#-compara√ß√£o-de-performance)
- [Recomenda√ß√µes por Caso de Uso](#-recomenda√ß√µes-por-caso-de-uso)
- [Exemplos Pr√°ticos](#-exemplos-pr√°ticos)
- [Links e Recursos](#-links-e-recursos)

## üîç Vis√£o Geral

O Kong Gateway suporta **3 linguagens principais** para desenvolvimento de plugins, cada uma com suas caracter√≠sticas espec√≠ficas, vantagens e casos de uso recomendados.

| Linguagem | Status | Runtime | Performance | Complexidade |
|-----------|--------|---------|-------------|--------------|
| **Lua** | ‚úÖ Nativo | LuaJIT | Excelente | Baixa |
| **Python** | ‚úÖ Oficial (PDK) | Processo separado | Boa | M√©dia |
| **JavaScript** | ‚úÖ Oficial (PDK) | Node.js | Boa | M√©dia |
| **Go** | üß™ Experimental | Compilado/PDK | Excelente | Baixa-M√©dia |

---

## üåô Lua (Nativo) - **Recomendado**

### Caracter√≠sticas
- **Status**: Linguagem principal e nativa do Kong
- **Runtime**: LuaJIT (Just-In-Time compiler)
- **Performance**: Excelente - execu√ß√£o mais r√°pida
- **Integra√ß√£o**: Acesso completo √†s APIs internas do Kong
- **Distribui√ß√£o**: Inclu√≠do diretamente no Kong

### ‚úÖ Vantagens
- **Performance superior**: LuaJIT oferece execu√ß√£o muito r√°pida
- **Acesso total**: APIs completas do Kong dispon√≠veis
- **Menor overhead**: Execu√ß√£o direta no processo do Kong
- **Documenta√ß√£o extensa**: Guias completos e exemplos
- **Ecossistema maduro**: Muitos plugins oficiais como refer√™ncia

### ‚ùå Desvantagens
- **Curva de aprendizado**: Para desenvolvedores n√£o familiarizados com Lua
- **Ecossistema limitado**: Menos bibliotecas comparado a Python/JavaScript
- **Debugging**: Ferramentas de debug menos robustas

### üéØ Casos de Uso Recomendados
- Plugins que exigem **alta performance**
- **Filtros de requisi√ß√£o/resposta** simples
- **Valida√ß√µes** e transforma√ß√µes r√°pidas
- **Rate limiting** customizado
- Plugins que ser√£o executados em **alto volume**

---

## üêç Python (Plugin Development Kit - PDK)

### Caracter√≠sticas
- **Status**: Suporte oficial via PDK
- **Runtime**: Processo Python separado que se comunica com Kong
- **Performance**: Boa, mas com overhead de comunica√ß√£o inter-processo
- **Integra√ß√£o**: Via Kong Python PDK

### ‚úÖ Vantagens
- **Linguagem popular**: Familiar para muitos desenvolvedores
- **Ecossistema rico**: PyPI com centenas de milhares de pacotes
- **Facilidade de desenvolvimento**: Sintaxe limpa e expressiva
- **Bibliotecas especializadas**: ML, data science, integra√ß√µes complexas
- **Debugging robusto**: Ferramentas avan√ßadas de debugging

### ‚ùå Desvantagens
- **Overhead de comunica√ß√£o**: IPC entre Kong e processo Python
- **Performance inferior**: Comparado ao Lua nativo
- **Complexidade operacional**: Gerenciamento de processo separado
- **Lat√™ncia adicional**: Serializa√ß√£o/deserializa√ß√£o de dados

### üéØ Casos de Uso Recomendados
- **Integra√ß√µes complexas** com sistemas externos
- Plugins que utilizam **bibliotecas de ML/AI**
- **Processamento de dados** avan√ßado
- **APIs REST/GraphQL** complexas
- Valida√ß√µes que requerem **bibliotecas espec√≠ficas**

---

## ‚òï JavaScript/Node.js (Plugin Development Kit - PDK)

### Caracter√≠sticas
- **Status**: Suporte oficial via PDK
- **Runtime**: Processo Node.js separado
- **Performance**: Boa, mas com overhead de comunica√ß√£o
- **Integra√ß√£o**: Via Kong JavaScript PDK

### ‚úÖ Vantagens
- **Linguagem ub√≠qua**: Conhecida pela maioria dos desenvolvedores web
- **NPM ecosystem**: Milh√µes de pacotes dispon√≠veis
- **Desenvolvimento r√°pido**: Prototipagem √°gil
- **JSON nativo**: Manipula√ß√£o natural de JSON
- **Async/await**: Padr√µes ass√≠ncronos familiares

### ‚ùå Desvantagens
- **Overhead de comunica√ß√£o**: Similar ao Python
- **Gerenciamento de mem√≥ria**: Garbage collection do V8
- **Single-threaded**: Limita√ß√µes do event loop
- **Performance**: Inferior ao Lua para opera√ß√µes CPU-intensivas

### üéØ Casos de Uso Recomendados
- **Prototipagem r√°pida** de plugins
- **Integra√ß√µes com APIs REST**
- Manipula√ß√£o complexa de **JSON/XML**
- **Webhooks** e notifica√ß√µes
- Plugins que utilizam **bibliotecas NPM espec√≠ficas**

---

## üîÑ Go (Suporte Experimental)

### Caracter√≠sticas
- **Status**: Em desenvolvimento/experimental
- **Runtime**: Via PDK ou plugins compilados
- **Performance**: Excelente (pr√≥xima ao Lua)
- **Status**: Ainda em evolu√ß√£o, suporte limitado

### ‚úÖ Vantagens Potenciais
- **Performance excelente**: Compila√ß√£o nativa
- **Concorr√™ncia nativa**: Goroutines
- **Type safety**: Tipagem est√°tica
- **Ecossistema crescente**: Bibliotecas Go

### ‚ùå Limita√ß√µes Atuais
- **Status experimental**: N√£o recomendado para produ√ß√£o
- **Documenta√ß√£o limitada**: Poucos exemplos
- **Suporte limitado**: Ainda em desenvolvimento

---

## üìä Compara√ß√£o de Performance

### Benchmarks Relativos

```
Lua (LuaJIT)     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100% (baseline)
Go               ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   ~95%
JavaScript       ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà           ~60%
Python           ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà             ~50%
```

### M√©tricas por Opera√ß√£o

| Opera√ß√£o | Lua | Python | JavaScript | Go |
|----------|-----|--------|------------|----|
| **String processing** | 100% | 45% | 65% | 90% |
| **JSON parsing** | 100% | 40% | 70% | 85% |
| **HTTP requests** | 100% | 35% | 55% | 88% |
| **Memory usage** | 100% | 180% | 140% | 95% |

---

## üéØ Recomenda√ß√µes por Caso de Uso

### üèÜ Use **Lua** quando:
- ‚úÖ Performance √© **cr√≠tica**
- ‚úÖ Plugin **simples a m√©dio**
- ‚úÖ Quer **integra√ß√£o nativa** com Kong
- ‚úÖ Equipe pode **aprender Lua**
- ‚úÖ **Alto volume** de requisi√ß√µes

### üêç Use **Python** quando:
- ‚úÖ Precisa de **bibliotecas espec√≠ficas** (ML, data science)
- ‚úÖ **Integra√ß√µes complexas** com sistemas externos
- ‚úÖ Equipe j√° **domina Python**
- ‚úÖ Performance **n√£o √© cr√≠tica**
- ‚úÖ **Prototipagem r√°pida** necess√°ria

### ‚òï Use **JavaScript** quando:
- ‚úÖ **Desenvolvimento web/API** familiar
- ‚úÖ Precisa de **pacotes NPM** espec√≠ficos
- ‚úÖ **Prototipagem r√°pida**
- ‚úÖ **Integra√ß√µes** com sistemas Node.js
- ‚úÖ Manipula√ß√£o intensiva de **JSON**

### üîÑ Use **Go** quando:
- ‚ö†Ô∏è **Ambiente de teste** apenas
- ‚ö†Ô∏è **Performance cr√≠tica** + tipagem est√°tica
- ‚ö†Ô∏è **Concorr√™ncia** avan√ßada necess√°ria

---

## üíª Exemplos Pr√°ticos

### üåô Plugin Lua - Header Customizado

```lua
-- kong/plugins/custom-header/handler.lua
local CustomHeaderPlugin = {
  PRIORITY = 1000,
  VERSION = "1.0.0",
}

function CustomHeaderPlugin:access(conf)
  kong.log.info("Custom Header Plugin executando!")
  
  -- Adicionar header customizado
  kong.service.request.set_header("X-Custom-Plugin", conf.header_value)
  kong.service.request.set_header("X-Request-ID", kong.request.get_header("request-id"))
  
  -- Log da requisi√ß√£o
  kong.log.info("Header adicionado: " .. conf.header_value)
end

return CustomHeaderPlugin
```

### üêç Plugin Python - Valida√ß√£o Avan√ßada

```python
# kong_plugin.py
import kong_pdk.pdk as kong

Schema = {
    "name": "advanced-validator",
    "fields": [
        {"required_fields": {"type": "array", "elements": {"type": "string"}}}
    ]
}

class Plugin:
    def __init__(self):
        pass

    def access(self, conf):
        # Valida√ß√£o avan√ßada usando bibliotecas Python
        request_body = kong.request.get_json_body()
        
        if not request_body:
            return kong.response.exit(400, {"error": "JSON body required"})
            
        # Validar campos obrigat√≥rios
        missing_fields = []
        for field in conf.required_fields:
            if field not in request_body:
                missing_fields.append(field)
                
        if missing_fields:
            return kong.response.exit(422, {
                "error": "Missing required fields",
                "fields": missing_fields
            })
            
        kong.log.info(f"Validation passed for {len(request_body)} fields")
```

### ‚òï Plugin JavaScript - Rate Limiting Inteligente

```javascript
// plugin.js
class IntelligentRateLimitPlugin {
  constructor() {
    this.name = 'intelligent-rate-limit';
    this.priority = 900;
    this.version = '1.0.0';
  }

  async access(conf) {
    const kong = this.kong;
    
    // Obter informa√ß√µes do cliente
    const clientIp = await kong.request.getHeader('x-real-ip') || 
                     await kong.client.getIp();
    const userAgent = await kong.request.getHeader('user-agent');
    
    // L√≥gica inteligente de rate limiting
    const rateLimit = this.calculateDynamicLimit(userAgent, clientIp);
    
    // Verificar cache Redis
    const currentCount = await this.redisClient.get(`rate_limit:${clientIp}`);
    
    if (currentCount && currentCount > rateLimit) {
      return kong.response.exit(429, {
        error: 'Rate limit exceeded',
        limit: rateLimit,
        current: currentCount,
        reset: await this.getResetTime(clientIp)
      });
    }
    
    // Incrementar contador
    await this.redisClient.incr(`rate_limit:${clientIp}`);
    await this.redisClient.expire(`rate_limit:${clientIp}`, 3600);
    
    kong.log.info(`Rate limit check passed: ${currentCount}/${rateLimit}`);
  }

  calculateDynamicLimit(userAgent, clientIp) {
    // L√≥gica personalizada baseada em padr√µes
    if (userAgent.includes('bot') || userAgent.includes('crawler')) {
      return 10; // Limite baixo para bots
    }
    
    if (this.isInternalIP(clientIp)) {
      return 1000; // Limite alto para IPs internos
    }
    
    return 100; // Limite padr√£o
  }
}

module.exports = IntelligentRateLimitPlugin;
```

---

## üìà Matriz de Decis√£o

| Crit√©rio | Lua | Python | JavaScript | Go |
|----------|-----|--------|------------|-----|
| **Performance** | üü¢ Excelente | üü° Boa | üü° Boa | üü¢ Excelente |
| **Facilidade** | üü° M√©dia | üü¢ F√°cil | üü¢ F√°cil | üü° M√©dia |
| **Ecossistema** | üü° Limitado | üü¢ Rico | üü¢ Rico | üü° Crescendo |
| **Documenta√ß√£o** | üü¢ Extensa | üü¢ Boa | üü¢ Boa | üî¥ Limitada |
| **Debugging** | üü° B√°sico | üü¢ Avan√ßado | üü¢ Avan√ßado | üü° Bom |
| **Produ√ß√£o** | üü¢ Pronto | üü¢ Pronto | üü¢ Pronto | üî¥ Experimental |

---

## üîó Links e Recursos

### üìö Documenta√ß√£o Oficial
- **Kong Plugin Development Guide**: [docs.konghq.com/gateway/latest/plugin-development/](https://docs.konghq.com/gateway/latest/plugin-development/)
- **Lua Reference**: [docs.konghq.com/gateway/latest/plugin-development/lua/](https://docs.konghq.com/gateway/latest/plugin-development/lua/)

### üõ†Ô∏è SDKs e Ferramentas
- **Kong Python PDK**: [github.com/Kong/kong-python-pdk](https://github.com/Kong/kong-python-pdk)
- **Kong JavaScript PDK**: [github.com/Kong/kong-js-pdk](https://github.com/Kong/kong-js-pdk)
- **Kong Go PDK**: [github.com/Kong/go-pdk](https://github.com/Kong/go-pdk)

### üìñ Tutoriais e Exemplos
- **Plugin Examples**: [github.com/Kong/kong-plugin](https://github.com/Kong/kong-plugin)
- **Community Plugins**: [docs.konghq.com/hub/](https://docs.konghq.com/hub/)

### üéì Workshops Relacionados
- **Projeto 07**: Custom Plugin Development (Lua)
- **Projeto 08**: Lua Deep Dive for Kong

---

## üèÜ Recomenda√ß√£o Final

### Para **M√°xima Performance**:
**Lua** √© a escolha ideal para plugins que ser√£o executados em alto volume e exigem performance cr√≠tica.

### Para **Desenvolvimento R√°pido**:
**Python** ou **JavaScript** s√£o excelentes para prototipagem r√°pida e integra√ß√µes complexas.

### Para **Casos Espec√≠ficos**:
Escolha a linguagem baseada no ecossistema de bibliotecas necess√°rias e expertise da equipe.

---

**üí° Dica**: Comece sempre com **Lua** para entender os conceitos fundamentais do Kong, depois migre para outras linguagens conforme a necessidade espec√≠fica do seu caso de uso.

---

*Documento criado como parte do Workshop "Desbloqueando Kong Gateway"*  
*Reposit√≥rio: [github.com/marcopollivier/desbloqueando-kong](https://github.com/marcopollivier/desbloqueando-kong)*
