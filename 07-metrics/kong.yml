_format_version: "3.0"
_transform: true

# Upstream configuration for load balancing
upstreams:
  - name: mock-apis-upstream
    algorithm: round-robin
    healthchecks:
      active:
        http_path: /health
        healthy:
          interval: 30
          http_statuses: [200, 302]
        unhealthy:
          http_statuses: [500, 502, 503, 504]
    targets:
      - target: go-mock-api-1:3001
        weight: 100
      - target: node-mock-api-2:3002
        weight: 100

# Service using the upstream
services:
  - name: mock-apis-service
    host: mock-apis-upstream
    protocol: http
    connect_timeout: 60000
    write_timeout: 60000
    read_timeout: 60000
    retries: 5

# Routes
routes:
  - name: api-route
    service: mock-apis-service
    protocols:
      - http
      - https
    methods:
      - GET
      - POST
      - PUT
      - PATCH
      - DELETE
    paths:
      - /api
    strip_path: true
    preserve_host: false

# Prometheus plugin for metrics
plugins:
  - name: prometheus
    config:
      per_consumer: true
      status_code_metrics: true
      latency_metrics: true
      bandwidth_metrics: true
      upstream_health_metrics: true
